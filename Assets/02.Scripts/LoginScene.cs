using System.Text.RegularExpressions;
using TMPro;
using UnityEngine;
using UnityEngine.SceneManagement;
using UnityEngine.UI;

/// <summary>
/// ë¡œê·¸ì¸ ì”¬ì„ ê´€ë¦¬í•˜ëŠ” í´ë˜ìŠ¤ì…ë‹ˆë‹¤.
/// ë¡œê·¸ì¸ê³¼ íšŒì›ê°€ì… UI ì „í™˜ ë° ì‚¬ìš©ì ì¸ì¦ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
/// 
/// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/// ğŸ“š í•™ìŠµ í¬ì¸íŠ¸: ë‹¨ì¼ ì±…ì„ ì›ì¹™ (SRP)
/// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/// 
/// ì´ í´ë˜ìŠ¤ì˜ ì±…ì„:
/// âœ… UI ìƒíƒœ ê´€ë¦¬ (ë¡œê·¸ì¸/íšŒì›ê°€ì… í™”ë©´ ì „í™˜)
/// âœ… ì‚¬ìš©ì ì…ë ¥ ê²€ì¦ (ì´ë©”ì¼ í˜•ì‹, ë¹„ë°€ë²ˆí˜¸ ê·œì¹™)
/// âœ… ì¸ì¦ ë¡œì§ ì¡°ìœ¨ (ì•”í˜¸í™”ëŠ” ë‹¤ë¥¸ í´ë˜ìŠ¤ì— ìœ„ì„)
/// 
/// ì´ í´ë˜ìŠ¤ê°€ í•˜ì§€ ì•ŠëŠ” ê²ƒ:
/// âŒ ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” â†’ IPasswordHasherê°€ ë‹´ë‹¹
/// âŒ ë°ì´í„° ì €ì¥ ë°©ì‹ ê²°ì • â†’ ë‚˜ì¤‘ì— ì„œë²„ ì—°ë™ ì‹œ êµì²´ ê°€ëŠ¥
/// 
/// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
/// </summary>
public class LoginScene : MonoBehaviour
{
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ì—´ê±°í˜• ì •ì˜
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    /// <summary>
    /// ì”¬ì˜ í˜„ì¬ ëª¨ë“œë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì—´ê±°í˜•ì…ë‹ˆë‹¤.
    /// </summary>
    private enum SceneMode
    {
        Login,
        Register
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // í•„ë“œ ì„ ì–¸
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    private SceneMode _mode = SceneMode.Login;

    [Header("ë¡œê·¸ì¸ UI")]
    [SerializeField] private GameObject _loginObject;
    [SerializeField] private Button _gotoRegisterButton;
    [SerializeField] private Button _loginButton;
    [SerializeField] private TMP_InputField _loginIdInputField;
    [SerializeField] private TMP_InputField _loginPasswordInputField;

    [Header("íšŒì›ê°€ì… UI")]
    [SerializeField] private GameObject _registerObject;
    [Tooltip("íšŒì›ê°€ì…ì—ì„œ ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼")]
    [SerializeField] private Button _gotoLoginButton;
    [SerializeField] private Button _registerButton;
    [SerializeField] private TMP_InputField _registerIdInputField;
    [SerializeField] private TMP_InputField _registerPasswordInputField;
    [SerializeField] private TMP_InputField _registerPasswordConfirmInputField;

    [Header("ê¸°íƒ€ UI")]
    [SerializeField] private TextMeshProUGUI _alarmText;

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ğŸ“š í•™ìŠµ í¬ì¸íŠ¸: ì˜ì¡´ì„± ì—­ì „ ì›ì¹™ (DIP)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 
    // ê³ ìˆ˜ì¤€ ëª¨ë“ˆ(LoginScene)ì´ ì €ìˆ˜ì¤€ ëª¨ë“ˆ(Sha256PasswordHasher)ì—
    // ì§ì ‘ ì˜ì¡´í•˜ì§€ ì•Šê³ , ì¶”ìƒí™”(IPasswordHasher)ì— ì˜ì¡´í•©ë‹ˆë‹¤.
    //
    // ì¥ì :
    // - ë‚˜ì¤‘ì— bcrypt, Argon2 ë“± ë‹¤ë¥¸ í•´ì‹œ ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ êµì²´ ìš©ì´
    // - í…ŒìŠ¤íŠ¸ ì‹œ Mock ê°ì²´ë¡œ ëŒ€ì²´ ê°€ëŠ¥
    //
    // ë¹„ìœ : "ë¦¬ëª¨ì»¨ê³¼ TV"
    // - ë¦¬ëª¨ì»¨(LoginScene)ì€ "ì „ì› ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ TVê°€ ì¼œì§„ë‹¤"ë¼ëŠ” ì¸í„°í˜ì´ìŠ¤ë§Œ ì•Œë©´ ë¨
    // - ì–´ë–¤ TV(í•´ì‹œ ì•Œê³ ë¦¬ì¦˜)ì¸ì§€ëŠ” ëª°ë¼ë„ ë¨
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    private readonly IPasswordHasher _passwordHasher = new Sha256PasswordHasher();

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ìƒìˆ˜ ì •ì˜: ë§¤ì§ ë¬¸ìì—´ ì œê±°
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    private const string NextSceneName = "LoadingScene";
    
    // ì •ê·œì‹ íŒ¨í„´ì„ ìƒìˆ˜ë¡œ ë¶„ë¦¬í•˜ì—¬ ê°€ë…ì„± í–¥ìƒ
    private const string EmailPattern = @"^[^@\s]+@[^@\s]+\.[^@\s]+$";
    private const string PasswordPattern = @"^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+=-])[A-Za-z\d!@#$%^&*()_+=-]{7,20}$";

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Unity ìƒëª…ì£¼ê¸° ë©”ì„œë“œ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    private void Start()
    {
        InitializeButtonEvents();
        RefreshUI();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ì´ˆê¸°í™” ë©”ì„œë“œ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    /// <summary>
    /// ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤.
    /// </summary>
    private void InitializeButtonEvents()
    {
        _gotoRegisterButton.onClick.AddListener(OnClickGotoRegister);
        _loginButton.onClick.AddListener(OnClickLogin);
        _gotoLoginButton.onClick.AddListener(OnClickGotoLogin);
        _registerButton.onClick.AddListener(OnClickRegister);
    }

    /// <summary>
    /// í˜„ì¬ ëª¨ë“œì— ë”°ë¼ UIë¥¼ ê°±ì‹ í•©ë‹ˆë‹¤.
    /// </summary>
    private void RefreshUI()
    {
        _registerObject.SetActive(_mode == SceneMode.Register);
        _loginObject.SetActive(_mode == SceneMode.Login);
        
        // ëª¨ë“œ ì „í™˜ ì‹œ ì•Œë¦¼ í…ìŠ¤íŠ¸ ì´ˆê¸°í™”
        ClearAlarmText();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ë¡œê·¸ì¸ ì²˜ë¦¬
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    /// <summary>
    /// ë¡œê·¸ì¸ ë²„íŠ¼ í´ë¦­ ì‹œ í˜¸ì¶œë©ë‹ˆë‹¤.
    /// 
    /// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    /// ğŸ“š ì²˜ë¦¬ íë¦„
    /// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    /// 
    /// 1. ì…ë ¥ê°’ ê²€ì¦ (ì•„ì´ë””, ë¹„ë°€ë²ˆí˜¸)
    /// 2. ì €ì¥ëœ ê³„ì • ì¡´ì¬ ì—¬ë¶€ í™•ì¸
    /// 3. ë¹„ë°€ë²ˆí˜¸ ê²€ì¦ (í•´ì‹œ ë¹„êµ)
    /// 4. ì„±ê³µ ì‹œ ë‹¤ìŒ ì”¬ìœ¼ë¡œ ì´ë™
    /// 
    /// ğŸ” ë³´ì•ˆ í¬ì¸íŠ¸:
    /// - "ì•„ì´ë””ê°€ ì—†ìŠµë‹ˆë‹¤" vs "ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤" êµ¬ë¶„í•˜ì§€ ì•ŠìŒ
    /// - í†µí•© ë©”ì‹œì§€ë¡œ ì–´ë–¤ ì •ë³´ê°€ í‹€ë ¸ëŠ”ì§€ ìˆ¨ê¹€ (ì •ë³´ ë…¸ì¶œ ë°©ì§€)
    /// 
    /// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    /// </summary>
    private void OnClickLogin()
    {
        // 1ë‹¨ê³„: ì•„ì´ë”” ì…ë ¥ í™•ì¸
        string id = _loginIdInputField.text;
        if (!ValidateNotEmpty(id, "ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."))
        {
            return;
        }

        // 2ë‹¨ê³„: ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í™•ì¸
        string password = _loginPasswordInputField.text;
        if (!ValidateNotEmpty(password, "ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."))
        {
            return;
        }

        // 3ë‹¨ê³„: ê³„ì • ì¡´ì¬ ì—¬ë¶€ í™•ì¸
        if (!PlayerPrefs.HasKey(id))
        {
            // ğŸ” ë³´ì•ˆ: êµ¬ì²´ì ì¸ ì˜¤ë¥˜ ì›ì¸ì„ ìˆ¨ê¹€
            ShowAlarm("ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
            return;
        }

        // 4ë‹¨ê³„: ì €ì¥ëœ í•´ì‹œ ê°€ì ¸ì˜¤ê¸°
        string storedHash = PlayerPrefs.GetString(id);

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // ğŸ“š í•µì‹¬ ë³€ê²½ì : ë¹„ë°€ë²ˆí˜¸ ê²€ì¦
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // 
        // ë³€ê²½ ì „ (ìœ„í—˜!):
        // if (storedPassword != password) { ... }
        // â†’ í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸ë¼ë¦¬ ì§ì ‘ ë¹„êµ
        // 
        // ë³€ê²½ í›„ (ì•ˆì „):
        // if (!_passwordHasher.VerifyPassword(password, storedHash)) { ... }
        // â†’ ì…ë ¥ëœ ë¹„ë°€ë²ˆí˜¸ë¥¼ í•´ì‹œí•œ í›„ ì €ì¥ëœ í•´ì‹œì™€ ë¹„êµ
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        if (!_passwordHasher.VerifyPassword(password, storedHash))
        {
            ShowAlarm("ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
            return;
        }

        // 5ë‹¨ê³„: ë¡œê·¸ì¸ ì„±ê³µ â†’ ë‹¤ìŒ ì”¬ìœ¼ë¡œ ì´ë™
        Debug.Log($"[LoginScene] ë¡œê·¸ì¸ ì„±ê³µ: {id}");
        SceneManager.LoadScene(NextSceneName);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // íšŒì›ê°€ì… ì²˜ë¦¬
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    /// <summary>
    /// íšŒì›ê°€ì… ë²„íŠ¼ í´ë¦­ ì‹œ í˜¸ì¶œë©ë‹ˆë‹¤.
    /// 
    /// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    /// ğŸ“š ì²˜ë¦¬ íë¦„
    /// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    /// 
    /// 1. ì•„ì´ë”” ì…ë ¥ ë° í˜•ì‹ ê²€ì¦ (ì´ë©”ì¼)
    /// 2. ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ ë° ê·œì¹™ ê²€ì¦
    /// 3. ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì¼ì¹˜ ì—¬ë¶€
    /// 4. ì¤‘ë³µ ì•„ì´ë”” ì²´í¬
    /// 5. ë¹„ë°€ë²ˆí˜¸ í•´ì‹œí™” í›„ ì €ì¥
    /// 6. ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™
    /// 
    /// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    /// </summary>
    private void OnClickRegister()
    {
        // 1ë‹¨ê³„: ì•„ì´ë”” ì…ë ¥ í™•ì¸
        string id = _registerIdInputField.text;
        if (!ValidateNotEmpty(id, "ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."))
        {
            return;
        }

        // 1-1ë‹¨ê³„: ì´ë©”ì¼ í˜•ì‹ ê²€ì¦
        if (!ValidateEmailFormat(id))
        {
            return;
        }

        // 2ë‹¨ê³„: ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í™•ì¸
        string password = _registerPasswordInputField.text;
        if (!ValidateNotEmpty(password, "ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."))
        {
            return;
        }

        // 2-1ë‹¨ê³„: ë¹„ë°€ë²ˆí˜¸ í˜•ì‹ ê²€ì¦
        if (!ValidatePasswordFormat(password))
        {
            return;
        }

        // 3ë‹¨ê³„: ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì¼ì¹˜ ì—¬ë¶€
        string passwordConfirm = _registerPasswordConfirmInputField.text;
        if (!ValidatePasswordMatch(password, passwordConfirm))
        {
            return;
        }

        // 4ë‹¨ê³„: ì¤‘ë³µ ì•„ì´ë”” ì²´í¬
        if (PlayerPrefs.HasKey(id))
        {
            ShowAlarm("ì¤‘ë³µëœ ì•„ì´ë””ì…ë‹ˆë‹¤.");
            return;
        }

        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // ğŸ“š í•µì‹¬ ë³€ê²½ì : ë¹„ë°€ë²ˆí˜¸ ì €ì¥
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        // 
        // ë³€ê²½ ì „ (ìœ„í—˜!):
        // PlayerPrefs.SetString(id, password);
        // â†’ í‰ë¬¸ ë¹„ë°€ë²ˆí˜¸ ê·¸ëŒ€ë¡œ ì €ì¥
        // â†’ PlayerPrefs íŒŒì¼ì„ ì—´ë©´ ë¹„ë°€ë²ˆí˜¸ê°€ ë³´ì„!
        // 
        // ë³€ê²½ í›„ (ì•ˆì „):
        // string hashedPassword = _passwordHasher.HashPassword(password);
        // PlayerPrefs.SetString(id, hashedPassword);
        // â†’ í•´ì‹œëœ ë¹„ë°€ë²ˆí˜¸ ì €ì¥
        // â†’ íŒŒì¼ì„ ì—´ì–´ë„ ì›ë³¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•Œ ìˆ˜ ì—†ìŒ
        // 
        // ì €ì¥ë˜ëŠ” í˜•ì‹ ì˜ˆì‹œ:
        // "user@email.com" â†’ "aBcDeFgH...:xYz123AbC..."
        //                     â†‘ Salt      â†‘ Hash
        // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        string hashedPassword = _passwordHasher.HashPassword(password);
        PlayerPrefs.SetString(id, hashedPassword);
        PlayerPrefs.Save();  // ì¦‰ì‹œ ì €ì¥ (ì•± ì¢…ë£Œ ì‹œ ë°ì´í„° ì†ì‹¤ ë°©ì§€)

        Debug.Log($"[LoginScene] íšŒì›ê°€ì… ì„±ê³µ: {id}");
        Debug.Log($"[LoginScene] ì €ì¥ëœ í•´ì‹œ: {hashedPassword}");

        ShowAlarm("íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
        OnClickGotoLogin();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // í™”ë©´ ì „í™˜ ë©”ì„œë“œ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    /// <summary>
    /// ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì „í™˜í•©ë‹ˆë‹¤.
    /// </summary>
    private void OnClickGotoLogin()
    {
        _mode = SceneMode.Login;
        RefreshUI();
    }

    /// <summary>
    /// íšŒì›ê°€ì… í™”ë©´ìœ¼ë¡œ ì „í™˜í•©ë‹ˆë‹¤.
    /// </summary>
    private void OnClickGotoRegister()
    {
        _mode = SceneMode.Register;
        RefreshUI();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ê²€ì¦ í—¬í¼ ë©”ì„œë“œ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    /// <summary>
    /// ë¬¸ìì—´ì´ ë¹„ì–´ìˆì§€ ì•Šì€ì§€ ê²€ì¦í•©ë‹ˆë‹¤.
    /// </summary>
    private bool ValidateNotEmpty(string value, string errorMessage)
    {
        if (string.IsNullOrEmpty(value))
        {
            ShowAlarm(errorMessage);
            return false;
        }
        return true;
    }

    /// <summary>
    /// ì´ë©”ì¼ í˜•ì‹ì„ ê²€ì¦í•©ë‹ˆë‹¤.
    /// 
    /// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    /// ğŸ“š ì •ê·œì‹ íŒ¨í„´ ì„¤ëª…: ^[^@\s]+@[^@\s]+\.[^@\s]+$
    /// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    /// 
    /// ^        : ë¬¸ìì—´ ì‹œì‘
    /// [^@\s]+  : @ì™€ ê³µë°±ì´ ì•„ë‹Œ ë¬¸ì 1ê°œ ì´ìƒ (ë¡œì»¬ íŒŒíŠ¸)
    /// @        : ë°˜ë“œì‹œ @ í¬í•¨
    /// [^@\s]+  : @ì™€ ê³µë°±ì´ ì•„ë‹Œ ë¬¸ì 1ê°œ ì´ìƒ (ë„ë©”ì¸)
    /// \.       : ë°˜ë“œì‹œ . í¬í•¨
    /// [^@\s]+  : @ì™€ ê³µë°±ì´ ì•„ë‹Œ ë¬¸ì 1ê°œ ì´ìƒ (TLD)
    /// $        : ë¬¸ìì—´ ë
    /// 
    /// ì˜ˆì‹œ:
    /// âœ… user@example.com
    /// âœ… test.user@mail.co.kr
    /// âŒ userexample.com (@ ì—†ìŒ)
    /// âŒ user@example (. ì—†ìŒ)
    /// 
    /// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    /// </summary>
    private bool ValidateEmailFormat(string email)
    {
        if (!Regex.IsMatch(email, EmailPattern))
        {
            ShowAlarm("ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.");
            return false;
        }
        return true;
    }

    /// <summary>
    /// ë¹„ë°€ë²ˆí˜¸ í˜•ì‹ì„ ê²€ì¦í•©ë‹ˆë‹¤.
    /// 
    /// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    /// ğŸ“š ì •ê·œì‹ íŒ¨í„´ ì„¤ëª…
    /// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    /// 
    /// ^                    : ë¬¸ìì—´ ì‹œì‘
    /// (?=.*[a-z])          : ì†Œë¬¸ì ìµœì†Œ 1ê°œ í¬í•¨ (Lookahead)
    /// (?=.*[A-Z])          : ëŒ€ë¬¸ì ìµœì†Œ 1ê°œ í¬í•¨
    /// (?=.*\d)             : ìˆ«ì ìµœì†Œ 1ê°œ í¬í•¨
    /// (?=.*[!@#$%^&*...])  : íŠ¹ìˆ˜ë¬¸ì ìµœì†Œ 1ê°œ í¬í•¨
    /// [A-Za-z\d!@#...]{7,20} : í—ˆìš© ë¬¸ìë¡œë§Œ 7~20ì
    /// $                    : ë¬¸ìì—´ ë
    /// 
    /// ì˜ˆì‹œ:
    /// âœ… Password1!
    /// âœ… MySecure@123
    /// âŒ password1! (ëŒ€ë¬¸ì ì—†ìŒ)
    /// âŒ PASSWORD1! (ì†Œë¬¸ì ì—†ìŒ)
    /// âŒ Password!! (ìˆ«ì ì—†ìŒ)
    /// âŒ Password1 (íŠ¹ìˆ˜ë¬¸ì ì—†ìŒ)
    /// âŒ Pass1! (7ì ë¯¸ë§Œ)
    /// 
    /// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    /// </summary>
    private bool ValidatePasswordFormat(string password)
    {
        if (!Regex.IsMatch(password, PasswordPattern))
        {
            ShowAlarm("ë¹„ë°€ë²ˆí˜¸ëŠ” 7~20ì ì˜ë¬¸ ëŒ€ì†Œë¬¸ì, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.");
            return false;
        }
        return true;
    }

    /// <summary>
    /// ë¹„ë°€ë²ˆí˜¸ì™€ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì´ ì¼ì¹˜í•˜ëŠ”ì§€ ê²€ì¦í•©ë‹ˆë‹¤.
    /// </summary>
    private bool ValidatePasswordMatch(string password, string passwordConfirm)
    {
        if (string.IsNullOrEmpty(passwordConfirm) || password != passwordConfirm)
        {
            ShowAlarm("ë¹„ë°€ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
            return false;
        }
        return true;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // UI í—¬í¼ ë©”ì„œë“œ
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    /// <summary>
    /// ì•Œë¦¼ ë©”ì‹œì§€ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
    /// </summary>
    private void ShowAlarm(string message)
    {
        _alarmText.text = message;
        Debug.Log($"[LoginScene] {message}");
    }

    /// <summary>
    /// ì•Œë¦¼ í…ìŠ¤íŠ¸ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
    /// </summary>
    private void ClearAlarmText()
    {
        _alarmText.text = string.Empty;
    }
}

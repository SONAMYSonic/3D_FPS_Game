using System;
using UnityEngine;

/// <summary>
/// μ†λ¨μ„± μ¤νƒ―μ„ κ΄€λ¦¬ν•λ” ν΄λμ¤μ…λ‹λ‹¤.
/// μ²΄λ ¥, μ¤νƒλ―Έλ‚, λ§λ‚ λ“± μ‹κ°„μ— λ”°λΌ νλ³µλκ³  μ‚¬μ© μ‹ κ°μ†ν•λ” μ¤νƒ―μ— μ‚¬μ©λ©λ‹λ‹¤.
/// 
/// β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
/// π“ ν•™μµ ν¬μΈνΈ: μµμ €λ²„ ν¨ν„΄ (Observer Pattern)
/// β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
/// 
/// λΉ„μ : "μ€ν–‰ μ”κ³  μ•λ¦Ό μ„λΉ„μ¤"
/// 
/// - μ΄ ν΄λμ¤ = μ€ν–‰ κ³„μΆ
/// - _onDataChanged = μ”κ³  λ³€λ™ μ•λ¦Ό μ„λΉ„μ¤
/// - κµ¬λ…μ = λ¬Έμ μ•λ¦Ό λ°›λ” μ‚¬λ (UI)
/// 
/// μ”κ³ κ°€ λ°”λ€” λ•λ§λ‹¤ μλ™μΌλ΅ λ¬Έμ μ•λ¦Όμ΄ κ°!
/// κµ¬λ…μκ°€ μ—†μΌλ©΄ μ•λ¦Όμ΄ μ• κ° λΏ, μ—λ¬λ” μ•„λ‹.
/// 
/// β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
/// </summary>
[Serializable]
public class ConsumableStat
{
    // β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
    // ν•„λ“
    // β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
    
    [SerializeField, Tooltip("μµλ€κ°’")]
    private float _maxValue;
    
    [SerializeField, Tooltip("ν„μ¬κ°’")]
    private float _value;
    
    [SerializeField, Tooltip("μ΄λ‹Ή νλ³µλ‰")]
    private float _regenValue;

    // β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
    // ν”„λ΅νΌν‹°
    // β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
    
    public float MaxValue => _maxValue;
    public float Value => _value;

    // β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
    // μ΄λ²¤νΈ
    // β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
    
    /// <summary>
    /// λ°μ΄ν„°κ°€ λ³€κ²½λμ—μ„ λ• νΈμ¶λλ” μ½λ°±μ…λ‹λ‹¤.
    /// 
    /// β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    /// π“ ν•™μµ ν¬μΈνΈ: Action vs event
    /// β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    /// 
    /// private Action _onDataChanged;
    /// - λ‹¨μ λ€λ¦¬μ (delegate)
    /// - μ™Έλ¶€μ—μ„ μ§μ ‘ νΈμ¶ κ°€λ¥ (μΊ΅μν™” μ•½ν•¨)
    /// 
    /// private event Action _onDataChanged;
    /// - μ΄λ²¤νΈ ν‚¤μ›λ“ μ¶”κ°€
    /// - μ™Έλ¶€μ—μ„ += / -= λ§ κ°€λ¥, μ§μ ‘ νΈμ¶ λ¶κ°€ (μΊ΅μν™” κ°•ν•¨)
    /// 
    /// μ—¬κΈ°μ„λ” Initialize()λ΅λ§ μ„¤μ •ν•λ―€λ΅ event μ—†μ΄ Action μ‚¬μ©
    /// 
    /// β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    /// </summary>
    private Action _onDataChanged;

    // β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
    // μ΄κΈ°ν™”
    // β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•

    /// <summary>
    /// μ¤νƒ―μ„ μ΄κΈ°ν™”ν•©λ‹λ‹¤.
    /// 
    /// β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    /// π“ ν•™μµ ν¬μΈνΈ: μ½λ°± ν•¨μ λ“±λ΅
    /// β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    /// 
    /// μ‚¬μ© μμ‹:
    /// Health.Initialize(HandleStatChanged);
    /// 
    /// μ΄λ ‡κ² ν•λ©΄:
    /// 1. Health κ°’μ΄ λ³€κ²½λ  λ•λ§λ‹¤
    /// 2. _onDataChangedκ°€ νΈμ¶λκ³ 
    /// 3. HandleStatChanged()κ°€ μ‹¤ν–‰λ¨
    /// 
    /// nullμ„ μ „λ‹¬ν•λ©΄ μ•λ¦Ό μ—†μ΄ κ°’λ§ λ³€κ²½λ¨ (ν…μ¤νΈμ©)
    /// 
    /// β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    /// </summary>
    /// <param name="onDataChanged">κ°’ λ³€κ²½ μ‹ νΈμ¶λ  μ½λ°± (μ„ νƒ)</param>
    public void Initialize(Action onDataChanged = null)
    {
        _onDataChanged = onDataChanged;
        SetValue(_maxValue);
    }

    // β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
    // κ°’ λ³€κ²½ λ©”μ„λ“
    // β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•

    /// <summary>
    /// μ‹κ°„μ— λ”°λΌ μ¤νƒ―μ„ νλ³µν•©λ‹λ‹¤.
    /// </summary>
    /// <param name="deltaTime">κ²½κ³Ό μ‹κ°„ (μ΄)</param>
    public void Regenerate(float deltaTime)
    {
        // μ΄λ―Έ μµλ€μΉλ©΄ νλ³µ λ¶ν•„μ”
        if (_value >= _maxValue)
        {
            return;
        }

        _value += _regenValue * deltaTime;
        _value = Mathf.Min(_value, _maxValue);  // μµλ€κ°’ μ΄κ³Ό λ°©μ§€

        NotifyChanged();
    }

    /// <summary>
    /// μ§€μ •ν• μ–‘λ§νΌ μ†λ¨λ¥Ό μ‹λ„ν•©λ‹λ‹¤.
    /// </summary>
    /// <param name="amount">μ†λ¨λ‰</param>
    /// <returns>μ†λ¨ μ„±κ³µ μ—¬λ¶€</returns>
    public bool TryConsume(float amount)
    {
        if (_value < amount)
        {
            return false;
        }

        Consume(amount);
        return true;
    }

    /// <summary>
    /// μ§€μ •ν• μ–‘λ§νΌ μ†λ¨ν•©λ‹λ‹¤.
    /// </summary>
    /// <param name="amount">μ†λ¨λ‰</param>
    public void Consume(float amount)
    {
        _value -= amount;
        _value = Mathf.Max(_value, 0f);  // μμ λ°©μ§€
        
        NotifyChanged();
    }

    /// <summary>
    /// μ§€μ •ν• μ–‘λ§νΌ μ¦κ°€ν•©λ‹λ‹¤.
    /// </summary>
    /// <param name="amount">μ¦κ°€λ‰</param>
    public void Increase(float amount)
    {
        SetValue(_value + amount);
    }

    /// <summary>
    /// μ§€μ •ν• μ–‘λ§νΌ κ°μ†ν•©λ‹λ‹¤.
    /// </summary>
    /// <param name="amount">κ°μ†λ‰</param>
    public void Decrease(float amount)
    {
        _value -= amount;
        _value = Mathf.Max(_value, 0f);
        
        NotifyChanged();
    }

    // β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
    // μµλ€κ°’ λ³€κ²½ λ©”μ„λ“
    // β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•

    /// <summary>
    /// μµλ€κ°’μ„ μ¦κ°€μ‹ν‚µλ‹λ‹¤.
    /// </summary>
    public void IncreaseMax(float amount)
    {
        _maxValue += amount;
        NotifyChanged();
    }

    /// <summary>
    /// μµλ€κ°’μ„ κ°μ†μ‹ν‚µλ‹λ‹¤.
    /// </summary>
    public void DecreaseMax(float amount)
    {
        _maxValue -= amount;
        _maxValue = Mathf.Max(_maxValue, 0f);
        
        // ν„μ¬κ°’μ΄ μµλ€κ°’λ³΄λ‹¤ ν¬λ©΄ μ΅°μ •
        if (_value > _maxValue)
        {
            _value = _maxValue;
        }
        
        NotifyChanged();
    }

    /// <summary>
    /// μµλ€κ°’μ„ μ„¤μ •ν•©λ‹λ‹¤.
    /// </summary>
    public void SetMaxValue(float value)
    {
        _maxValue = Mathf.Max(value, 0f);
        
        if (_value > _maxValue)
        {
            _value = _maxValue;
        }
        
        NotifyChanged();
    }

    /// <summary>
    /// ν„μ¬κ°’μ„ μ„¤μ •ν•©λ‹λ‹¤.
    /// </summary>
    public void SetValue(float value)
    {
        _value = Mathf.Clamp(value, 0f, _maxValue);
        NotifyChanged();
    }

    // β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•
    // λ‚΄λ¶€ ν—¬νΌ
    // β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•β•

    /// <summary>
    /// κµ¬λ…μμ—κ² λ°μ΄ν„° λ³€κ²½μ„ μ•λ¦½λ‹λ‹¤.
    /// 
    /// β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    /// π“ ν•™μµ ν¬μΈνΈ: Null μ΅°κ±΄λ¶€ μ—°μ‚°μ (?.)
    /// β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    /// 
    /// _onDataChanged?.Invoke();
    /// 
    /// μ΄κ²ƒμ€ μ•„λ μ½”λ“μ™€ λ™μΌ:
    /// if (_onDataChanged != null)
    /// {
    ///     _onDataChanged.Invoke();
    /// }
    /// 
    /// κµ¬λ…μκ°€ μ—†μΌλ©΄ μ΅°μ©ν λ¬΄μ‹λ¨ (μ—λ¬ μ—†μ)
    /// 
    /// β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
    /// </summary>
    private void NotifyChanged()
    {
        _onDataChanged?.Invoke();
    }
}
